#!/usr/bin/bash
#>=---------------------------------------------------------------------------------=<#
#               . '..:'.,                "                ,,                          #
#                ..:'/|/    PROGRAMMAS PRIEKš STIPRAJIEM // ПРАГРАМЫ ДЛЯ МАГУТНЫХ     #
#              '..:'/#|    >-------------x--------------''-----------------------<    #
#           . '..:'/&#|         :&&###&& "        :&####&&      ,   '  ,              #
#             ..:'/!|#|        :&# ''' #&"       :&#:''':#&      '    , .  , |        #
#        .  '..:'/!/|#|        &#''::: :#"    . :&#: ':: :#&  '  \;:8888888: | , /    #
#        . '..:'/!/:|#|       :&#  '::. :"&  .. :&#:  ':: &&    \,:88 ::: 88:| '/,'   #
#          ..:'/!/:.|#|       :&#:    '.."#& .. :&#:    : #:   _,:88 ::::: 88:'/,     #
#        '..:'/!/:::|#|   /   :&#      :.":&  ..:&#::  .:/:   ',:88 /@&nu- 88:/, ,'   #
#     . '..:'/!/:.:.|#| .8o/   :&#:     ."i:  .. :&#:  ', , '-, :88 :::!) 88:/',' _,-"#
#       ..:'/!/:::. |#| _(@_    :&#::    "  : .. :&#:      "'-,_:88 '::: 88:/,',^"__  #
#     '..:'/!/:.:...|#| /i'^     :&&##:_-"---  . :&#::   ______.,:88888888_:,.;==____,#
#  . '..:'/!/:::  . |#|  /  _     ::&&###"##&&  . :&#:    '----:88 #### 88:\',;-_     #
#    ..:'/!/:.:... .|#|_=rnn&]       .^^^"^^i#& . :&#::  ';,__:88 ''"!@# 8:|\'',-'-_  #
#  '..:'/!/@)::@).. |#| ^:#&]      :  ...".  i#& .':&#:   '==;:88 ##u,._ 8:||\-_',    #
#  ..:'/!/:.::.. .  |#|   :#&]     ::    "... i#&  :&#:     ,-=:88 #### 8: |'|\,_     #
# ..:'/!/::::....   |#|    :#&]    .#:      .. |#& :&#::     ,;':8888888:/ | '|',     #
# .:'/!/:.::.. .  . |#|     :#&]   .&#:      . |#& ':&#:       _" ,'/  ' ' |' '       #
#  _/!/-------------|#|__    :#&]   &#:: "   . |#&  :&#::     ' ,' /  /' ; | ,        #
# |.!:!i!&!&!&!X&X&#&####|    :#&]   &#::"   . |#& . :&#::   .:#& /  "  ,             #
# &|^^^^^^^^^^^^^^^^^^^|&|    _:#&]   &#:"    /#&  .. :&#::.::#& /  '  ,'             #
# ^"                   "^' .d0IXI&]iXb &&"####&#    .. :&&###&& /                     #
#                                       `"^^^''          `^^^'                        #
#>=-----------------------v---------------------------------------------------------=<#
VERSION="2024.02.27"      #             ,----,                                        #
V_STAGE="Alpha"           #           .'   .`|                                        #
V_CODENAME="Daugavpils"   #        .'   .'   ;                                        #
ALGO_V="I"                #      ,---, '    .' .-..    .---.    .---.    .---.        #
#>=---------------------=<#      |   :     ./ /    \  / .-, \  /  _  \  /  _  \       #
#/ .:::::::::::::::::::. \#      ;   | .'  / ' .-,  ;(__) ; | . .' `. ;. .' `. ;      #
# .::::..   .....   ..::. #      `---' /  ;  | |  . |  .'`  | | '   | || '   | |      #  
# :::::::.  :::::   ::::: #        /  ;  /   | |  | | / .'| | _\_`.(___)\_`.(___)     #
# ::::::.  ::::::   ::::: #       ;  /  /--, | |  | || /  | |(   ). '.(   ). '.       #
# :::::'  :::::::   ::::: #      /  /  / .`| | |  ' |; |  ; | | |  `\ || |  `\ |      #
# :::::  .:::::::   ::::: #    ./__;       : | `-'  '' `-'  | ; '._,' '; '._,' '      #
# :::   ...........   ::: #    |   :     .'  | \__.' `.__.'_.  '.___.'  '.___.'       #
# ':: .:::::::::::::. ::' #    ;   |  .'     | |   https://github.com/disc-8/zpass    #
#\ ':.:::::::::::::::.:' /#    `---'        (___)                                     #
#>=-----------------------^---------------------------------------------------------=<#

HELP="
ДiSC-8 [32mzpass [0m$VERSION $V_STAGE «[32m$V_CODENAME[0m» - Algorithm version [32m$ALGO_V[0m
a reasonably secure password generator and manager
--------------------------------------------------
[1mRecommended usage:[0m
\t[32m$[0m zpass [0m[[32musername[0m] [[32mwebsite[0m]

[1mAlternative usage example:[0m
Feel free to change it around a bit, as the randomness will add extra security.
\t[32m$[0m zpass [0m[[32mwebsite[0m] [[32mpet's name[0m]
--------------------------------------------------
Copyright Артём Васильев, ДiSC-8 Group 2024. [1mAll rights reserved.[0m
\n"

passcalc(){                                                                           
#  _____ _____ _____    _____ __    _____ _____ _____ _____ _____ _____ _____ 
# |_   _|  |  |   __|  |  _  |  |  |   __|     | __  |     |_   _|  |  |     |
#   | | |     |   __|  |     |  |__|  |  |  |  |    -|-   -| | | |     | | | |
#   |_| |__|__|_____|  |__|__|_____|_____|_____|__|__|_____| |_| |__|__|_|_|_|
#-------------------------------------------------------------------------------------#
# NOTE FOR CONTRIBUTORS:
# DO **NOT** EDIT THIS CODE UNLESS IT'S REFACTORING OR A MAJOR SECURITY UPDATE
# IF YOU CHANGE THE ALGORITHM IT WILL BREAK **ALL OLD PASSWORDS!!!**
#-------------------------------------------------------------------------------------#
# Variable diagram:
# $ zpass [$1] [$2]
#   read SECRET
#-------------------------------------------------------------------------------------#
  
 echo "$1"|sha256hmac -K "$2"     |sha384hmac -K "$SECRET"|sha512sum|xxd -p -r|tr -cd '[:print:]'|tr -d ' \n';
 echo "$1"|sha512hmac -K "$SECRET"|sha256hmac -K "$2"     |sha512sum|xxd -p -r|tr -cd '[:print:]'|tr -d ' \n';
 echo "$1"|sha384hmac -K "$2"     |sha512hmac -K "$SECRET"|sha512sum|xxd -p -r|tr -cd '[:print:]'|tr -d ' \n';
 echo "$1"|sha384hmac -K "$SECRET"|sha224hmac -K "$2"     |sha512sum|xxd -p -r|tr -cd '[:print:]'|tr -d ' \n';
}

# Close when not enough arguments
if [ -z "$2" ]; then
 printf "$HELP"
 exit
fi

# Generate the secret using user input
 read -sp "[[32mzpass[0m:[32m$(date +%T)[0m] Master password:
[32m>[0m " SECRET_CHUNK
 SECRET="$(printf "$SECRET_CHUNK"|sha384sum|xxd -ps -r)"
 echo #newline after input
 
 printf "[[32mzpass[0m:[32m$(date +%T)[0m] Password for [1;32m$1[0m at [1;32m$2[0;1m:[0;32m\n"
  passcalc "$1" "$2"
 printf "\n[0m"
